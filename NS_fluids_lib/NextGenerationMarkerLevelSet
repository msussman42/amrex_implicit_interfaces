GPU capability, MPI capability, OpenMP
AMR capability,
Particle Container
Multimaterial

Each material has an associated level set function which is initialized
as a distance function locally to the interface.

Each particle has an associated material id which is assigned only when the
particle is added.

There 3 kinds of particles:
a) bulk particles
b) narrow band particles (min |phi_{m}| < alpha h)
c) close-in narrow band particles x^init-=phi_{m} n_{m}

Each particle has a position, displacement, velocity, density, temperature, 
material id, and species.

u_t = -u div u + I[ div(2 mu D) ] - I[ grad p/rho ] + F_Boussinesq.
Feedback to Eulerian grid proportional to "h."
A temporary Material velocity UMAC_{m} is derived from UMAC.

1. initialize Levelsets, make them locally distance functions. 
2. generate the AMR grid near zero level set(s).
3. a) delete particles if (i) imat_id((I_LS)(xpart))!=imat_id(particle) and
      (ii) |I_LS(xpart)_imat_id| > alpha h
   b) add bulk, narrow band, and close-in narrow band particles.
4. For each material, the advective velocity is UMAC
5. (a) LS_{t} + div (UMAC LS) = 0 (using PPM or WENO or ...)
   (b) project LS_{m} to be "vacuum free."
6. advect the particles using UMAC
7. Redistance the level set function(s) using dtau=dx/2 for example:
    (a) LS0 is given
    (b) for n=1,2,3,...
          for each grid cell:
          (i) find grad LS(n-1) using upwinded WENO
          (ii) x_test=x-dtau sign(LS0) grad LS/|grad LS| 
          (iii) if sign(I LS(x_test))=sign(LS0) then
                 S \equiv sign(LS0)
                else
                 S \equiv sign(LS0) |LS(n-1)|/
                   (|LS(n-1)|+|I LS(x_test)|)
                endif
                LS(n)=LS(n-1)+dtau S *(1-|grad LS|)
                ( (LS(n)-LS(n-1))/dtau + S * n dot grad LS = +S
          (iv) lambda=sum w(||x-xp||)(I LS(n)(xp))/sum w(||x-xp||
               min w(||x-xp||)(I LS(xp)-lambda)^2
               LScorrect(n)=LS(n)-lambda
          (v) for bulk particles in which imat((I LS(n))(xp)) is 
              inconsistent with imat(particle), make the following 
              correction:
              mu=sum_{particle_inconsistent}
                w(||x-xp||)(I LS(n)(xp))/sum w(||x-xp||
                min w(||x-xp||)(I LS(xp)-mu)^2
               LScorrect(n)=LS(n)-mu

    (c) endfor
8. go back to step 2.

References:
Peng, D., Merriman, B., Osher, S., Zhao, H., & Kang, M. (1999). A PDE-based fast local level set method. Journal of computational physics, 155(2), 410-438.

work plan:
1. fix all the nested loops
2. make sure code works for single precision (VOFTOL, INTERCEPT_TOL, solver
default tolerances, etc)
3. check freezing results, restart bubble jetting.
4. Directionally split
   Level set advection and bulk material advection done in c++.
